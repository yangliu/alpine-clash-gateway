#!/sbin/openrc-run

acg_path="/opt/acg"

# Load Configuration
if [ -f "${acg_path}/files/acg-cfg" ]; then
  . "${acg_path}/files/acg-cfg"
else
  echo "The configuration file is missing. Please re-run the installation script."
  exit 1
fi
# Load Version
. "${acg_path}/files/version"

command="${acg_path}/scripts/clash-proxy"
command_args="${CLASH_PATH}/clash -d ${CLASH_PATH}"
command_background=true
pidfile="/run/${RC_SVCNAME}.pid"
name="Alpine Clash Gateway"
description="Alpine Clash Gateway start-up script for OpenRC"

depend() {
	need net
	use dns
}

start_pre() {
	${acg_path}/scripts/setup-cgroup.sh
	${acg_path}/scripts/modify-config.sh
}
start_post() {
	${acg_path}/scripts/proxy-selected.sh load
}

stop_pre() {
	${acg_path}/scripts/proxy-selected.sh save
}

